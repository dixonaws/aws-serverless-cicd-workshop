<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.64.1" />
    <meta name="description" content="Building a CI/CD pipeline for Serverless applications">
<meta name="author" content="Fernando Dingler &lt;fdingler@amazon.com&gt;">

    <link rel="shortcut icon" href="https://a0.awsstatic.com/libra-css/images/site/fav/favicon.ico" type="image/ico" />
<link rel="icon" href="https://a0.awsstatic.com/libra-css/images/site/fav/favicon.ico" type="image/ico" />
    <title>How does it work :: </title>

    
    <link href="../css/nucleus.css" rel="stylesheet">
    <link href="../css/fontawesome-all.min.css" rel="stylesheet">
    <link href="../css/hybrid.css" rel="stylesheet">
    <link href="../css/featherlight.min.css" rel="stylesheet">
    <link href="../css/perfect-scrollbar.min.css" rel="stylesheet">
    <link href="../css/auto-complete.css" rel="stylesheet">
    <link href="../css/atom-one-dark-reasonable.css" rel="stylesheet">
    <link href="../css/theme.css" rel="stylesheet">
    <link href="../css/hugo-theme.css" rel="stylesheet">
    
      <link href="../css/theme-aws.css" rel="stylesheet">
    

    <script src="../js/jquery-3.3.1.min.js"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
        :not(pre) > code + span.copy-to-clipboard {
            display: none;
        }
      
    </style>
    
  </head>
  <body class="" data-url="/canaries/intro.html">
    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <div id="aws-logo">
    <a href="../" title="Go home">
        <img style="vertical-align:middle" src="../images/logo.png" height="70px" />
    </a>
</div>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="../js/lunr.min.js"></script>
<script type="text/javascript" src="../js/auto-complete.js"></script>
<script type="text/javascript">
    
        var baseurl = "";
    
</script>
<script type="text/javascript" src="../js/search.js"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          


 
  
    
    <li data-nav-id="/setup.html" title="Setup" class="dd-item 
        
        
        
        ">
      <a href="../setup.html">
          <b>0. </b>Setup
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/setup/cloud9.html" title="Create a Cloud9 Workspace" class="dd-item 
        
        
        
        ">
      <a href="../setup/cloud9.html">
          Create a Cloud9 Workspace
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/setup/bootstrap.html" title="Upgrade SAM CLI" class="dd-item 
        
        
        
        ">
      <a href="../setup/bootstrap.html">
          Upgrade SAM CLI
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/sam.html" title="Create a new SAM app" class="dd-item 
        
        
        
        ">
      <a href="../sam.html">
          <b>1. </b>Create a new SAM app
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/sam/init.html" title="Initialize project" class="dd-item 
        
        
        
        ">
      <a href="../sam/init.html">
          Initialize project
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/sam/architecture.html" title="Project Architecture" class="dd-item 
        
        
        
        ">
      <a href="../sam/architecture.html">
          Project Architecture
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/sam/template.html" title="Explore the SAM template" class="dd-item 
        
        
        
        ">
      <a href="../sam/template.html">
          Explore the SAM template
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/sam/code.html" title="Explore the Lambda code" class="dd-item 
        
        
        
        ">
      <a href="../sam/code.html">
          Explore the Lambda code
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/local.html" title="Run project locally" class="dd-item 
        
        
        
        ">
      <a href="../local.html">
          <b>2. </b>Run project locally
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/local/dependencies.html" title="Install dependencies" class="dd-item 
        
        
        
        ">
      <a href="../local/dependencies.html">
          Install dependencies
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/local/run.html" title="Run using SAM CLI" class="dd-item 
        
        
        
        ">
      <a href="../local/run.html">
          Run using SAM CLI
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/local/change.html" title="Make a code change" class="dd-item 
        
        
        
        ">
      <a href="../local/change.html">
          Make a code change
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/local/unittests.html" title="Run the unit tests" class="dd-item 
        
        
        
        ">
      <a href="../local/unittests.html">
          Run the unit tests
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/manualdeploy.html" title="Manual Deploy to AWS" class="dd-item 
        
        
        
        ">
      <a href="../manualdeploy.html">
          <b>3. </b>Manual Deploy to AWS
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/manualdeploy/bucket.html" title="Let&#39;s talk about artifacts" class="dd-item 
        
        
        
        ">
      <a href="../manualdeploy/bucket.html">
          Let&#39;s talk about artifacts
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/manualdeploy/build.html" title="Build the app" class="dd-item 
        
        
        
        ">
      <a href="../manualdeploy/build.html">
          Build the app
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/manualdeploy/deploy.html" title="Deploy the app" class="dd-item 
        
        
        
        ">
      <a href="../manualdeploy/deploy.html">
          Deploy the app
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/manualdeploy/verify.html" title="Verify deployment" class="dd-item 
        
        
        
        ">
      <a href="../manualdeploy/verify.html">
          Verify deployment
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/buildpipe.html" title="Build the pipeline" class="dd-item 
        
        
        
        ">
      <a href="../buildpipe.html">
          <b>4. </b>Build the pipeline
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/buildpipe/gitrepo.html" title="Create a Git Repository" class="dd-item 
        
        
        
        ">
      <a href="../buildpipe/gitrepo.html">
          Create a Git Repository
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/buildpipe/credhelper.html" title="Configure credentials" class="dd-item 
        
        
        
        ">
      <a href="../buildpipe/credhelper.html">
          Configure credentials
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/buildpipe/gitpush.html" title="Push the code" class="dd-item 
        
        
        
        ">
      <a href="../buildpipe/gitpush.html">
          Push the code
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/buildpipe/pipeline.html" title="Creating the pipeline" class="dd-item 
        
        
        
        ">
      <a href="../buildpipe/pipeline.html">
          Creating the pipeline
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/buildpipe/pipeline/launch.html" title="Launch template" class="dd-item 
        
        
        
        ">
      <a href="../buildpipe/pipeline/launch.html">
          Launch template
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/buildpipe/verify.html" title="Verify creation" class="dd-item 
        
        
        
        ">
      <a href="../buildpipe/verify.html">
          Verify creation
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/buildpipe/buildspec.html" title="Write the buildspec file" class="dd-item 
        
        
        
        ">
      <a href="../buildpipe/buildspec.html">
          Write the buildspec file
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/buildpipe/done.html" title="Verify pipeline running" class="dd-item 
        
        
        
        ">
      <a href="../buildpipe/done.html">
          Verify pipeline running
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/buildpipe/launch.html" title="" class="dd-item 
        
        
        
        ">
      <a href="../buildpipe/launch.html">
          
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/canaries.html" title="Canary Deployments" class="dd-item 
        parent
        
        
        ">
      <a href="../canaries.html">
          <b>5. </b>Canary Deployments
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/canaries/intro.html" title="How does it work" class="dd-item 
        parent
        active
        
        ">
      <a href="../canaries/intro.html">
          How does it work
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/canaries/sam.html" title="Update SAM template" class="dd-item 
        
        
        
        ">
      <a href="../canaries/sam.html">
          Update SAM template
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/canaries/monitor.html" title="Monitor canary health" class="dd-item 
        
        
        
        ">
      <a href="../canaries/monitor.html">
          Monitor canary health
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/canaries/codedeploy.html" title="Verify in CodeDeploy" class="dd-item 
        
        
        
        ">
      <a href="../canaries/codedeploy.html">
          Verify in CodeDeploy
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/canaries/rollbacks.html" title="Rollbacks" class="dd-item 
        
        
        
        ">
      <a href="../canaries/rollbacks.html">
          Rollbacks
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/canaries/rollbacks/waitfordeploy.html" title="Wait for deployment to start" class="dd-item 
        
        
        
        ">
      <a href="../canaries/rollbacks/waitfordeploy.html">
          Wait for deployment to start
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/canaries/rollbacks/faketraffic.html" title="Invoke the canary" class="dd-item 
        
        
        
        ">
      <a href="../canaries/rollbacks/faketraffic.html">
          Invoke the canary
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/canaries/rollbacks/codedeploy.html" title="Watch CodeDeploy rollback" class="dd-item 
        
        
        
        ">
      <a href="../canaries/rollbacks/codedeploy.html">
          Watch CodeDeploy rollback
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/canaries/finished.html" title="The end" class="dd-item 
        
        
        
        ">
      <a href="../canaries/finished.html">
          The end
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
         
    </ul>

    
    

    
    <section id="footer">
      <span>
    <a href="https://github.com/aws-samples/aws-serverless-cicd-workshop">
        <i class="fab fa-github fa-lg"></i>
        GitHub
    </a>
</span>
<left>
    <h5 class="copyright">&copy; 2019 Amazon Web Services, Inc. or its Affiliates. All rights reserved.<h5>
</left>

    </section>
  </div>
</nav>





        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                  
                  
                  
                  <div id="top-github-link">
                    <a class="github-link" title='Edit this page' href="https://github.com/aws-samples/serverless-workshopscanaries/intro/_index.en.md" target="blank">
                      <i class="fas fa-code-branch"></i>
                      <span id="top-github-link-text">Edit this page</span>
                    </a>
                  </div>
                  
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            <a href='../'>CI/CD for Serverless Applications</a> > <a href='../canaries.html'>Canary Deployments</a> > How does it work
          
         
          
         
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#lambda-versions-and-aliases">Lambda versions and aliases</a></li>
        <li><a href="#traffic-shifting-with-lambda-aliases">Traffic shifting with Lambda aliases</a></li>
        <li><a href="#traffic-shifting-with-sam-and-codedeploy">Traffic shifting with SAM and CodeDeploy</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              How does it work
            </h1>
          

        




	<p>Before we jump into implementing Canary Deployments, lets first understand how this works:</p>
<p>The concepts of blue/green and canary deployments have been around for a while and have been well-established as best-practices for reducing the risk of software deployments. In traditional applications, you slowly and incrementally update the servers in your fleet while simultaneously verifying application health. However, there is somewhat of an impedance mismatch when mapping these concepts to a serverless world. You can’t incrementally deploy your software across a fleet of servers when there are no servers!</p>
<p>The answer is that there are a couple of services and features involved in making this possible. Let us explain:</p>
<h3 id="lambda-versions-and-aliases">Lambda versions and aliases</h3>
<p>AWS Lambda allows you to publish multiple versions of the same function. Each version has its own code and associated dependencies, as well as its own function settings (like memory allocation, timeout and environment variables). You can then refer to a given version by using a Lambda Alias. An alias is nothing but a name that can be pointed to a given version of a Lambda function.</p>
<p><img src="../images/lambda-versions-aliases.png" alt="VersionsAndAliases"></p>
<h3 id="traffic-shifting-with-lambda-aliases">Traffic shifting with Lambda aliases</h3>
<p>With the introduction of alias traffic shifting, it is now possible to trivially implement canary deployments of Lambda functions. By updating additional version weights on an alias, invocation traffic is routed to the new function versions based on the weight specified. Detailed CloudWatch metrics for the alias and version can be analyzed during the deployment, or other health checks performed, to ensure that the new version is healthy before proceeding.</p>
<p><img src="../images/traffic-shifting.png" alt="TrafficShifting"></p>
<h3 id="traffic-shifting-with-sam-and-codedeploy">Traffic shifting with SAM and CodeDeploy</h3>
<p>AWS CodeDeploy provides an intuitive turn-key implementation of this functionality integrated directly into AWS SAM. Traffic-shifted deployments can be declared in a SAM template, and CodeDeploy manages the function rollout as part of the CloudFormation stack update. CloudWatch alarms can also be configured to trigger a stack rollback if something goes wrong.</p>
<p><img src="../images/traffic-shifting-codedeploy.png" alt="TrafficShiftingCodeDeploy"></p>





<footer class=" footline" >
	
</footer>

        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
        
        


	 
	 
		
			<a class="nav nav-prev" href="../canaries.html" title="Canary Deployments"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="../canaries/sam.html" title="Update SAM template" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="../js/clipboard.min.js"></script>
    <script src="../js/perfect-scrollbar.min.js"></script>
    <script src="../js/perfect-scrollbar.jquery.min.js"></script>
    <script src="../js/jquery.sticky.js"></script>
    <script src="../js/featherlight.min.js"></script>
    <script src="../js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="../js/modernizr.custom-3.6.0.js"></script>
    <script src="../js/learn.js"></script>
    <script src="../js/hugo-learn.js"></script>

    <link href="../mermaid/mermaid.css" rel="stylesheet" />
    <script src="../mermaid/mermaid.js"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    

  </body>
</html>
